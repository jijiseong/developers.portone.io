---
title: KSNET
description: KSNET 결제창 연동 가이드입니다.
targetVersions: ["v1"]
versionVariants:
  v2: /ko/v2-payment/pg/ksnet
---

import Figure from "~/components/Figure.astro";
import Details from "~/components/gitbook/Details.astro";
import ParamTree from "~/components/gitbook/ParamTree.astro";
import Tab from "~/components/gitbook/tabs/Tab.astro";
import Tabs from "~/components/gitbook/tabs/Tabs.astro";
import Hint from "~/components/Hint.astro";

<Figure src="/gitbook-assets/ko/image (74).png" caption="KSNET" />

## 1. KSNET 채널 설정하기

[결제대행사 채널 설정하기](../../ready/readme#3-결제대행사-채널-설정하기) 페이지의 내용을 참고하여
채널 설정을 진행합니다.

## 2. 결제 요청하기

[JavaScript SDK (신규)](../../sdk/javascript-sdk/readme)의 `IMP.request_pay(param, callback)`을 호출하여
KSNET 결제창을 호출할 수 있습니다. **결제결과**는 PC의 경우 `IMP.request_pay(param, callback)` 호출 후
<mark style="color:red;">**callback**</mark>으로 수신되고 모바일의 경우 <mark style="color:red;">**m\_redirect\_url**</mark>로 리디렉션됩니다.

<Hint style="info">
  KSNET 결제는 최신 SDK에서만 지원됩니다.
  기존 JavaScript SDK를 사용 중이신 경우 [JavaScript SDK (신규)](../../sdk/javascript-sdk/readme) 문서를 참고하여 업데이트를 진행해주세요.

  **KSNET을 연동하기 위해서는 위에 안내된 JS SDK를 이용하셔야 합니다.**
</Hint>

```html
<script src="https://cdn.iamport.kr/v1/iamport.js"></script>
```

<Hint style="danger">
  **기존에 deprecated된 응답들은 모두 제거**됐습니다.

  KSNET 연동시에 사용되는 신규 JS SDK는 기존 모듈에서 제공했던 CallBack 파라미터가 대부분 삭제되었습니다.(특히 deprecated 로 명시된 파라미터는 모두 삭제되었습니다.)

  해당 JS SDK 사용시 Callback 으로 내려받을수 있는 데이터는 오직 아래 두가지 입니다.

  **`imp_uid`, `merchant_uid`**

  따라서 해당 SDK를 사용하실때는 `IMP.request_pay`로부터 응답된 객체(또는 쿼리 파라미터)에서 `imp_uid`를 가지고 **아임포트 REST API(GET `/payments/imp_uid`)로 결제 상세 내역(승인 상태, 승인 결과 등등)을 조회**하여 응답 파라미터 중 status 파라미터로 결제 상태를 파악하셔야 합니다.
</Hint>

<Tabs>
  <Tab title="인증결제창 요청">
    ```ts title="JavaScript SDK"
    IMP.request_pay(
      {
        pg: "ksnet.{PG 상점 아이디}", // 테스트인 경우 ksnet.2999199999
        pay_method: "card",
        merchant_uid: "order_id_1667634130160", // 상점에서 채번하는 고유 주문 번호
        name: "나이키 와플 트레이너 2 SD",
        pay_method: "card",
        escrow: false,
        amount: "109000",
        tax_free: 3000,
        buyer_name: "홍길동",
        buyer_email: "buyer@example.com",
        buyer_tel: "02-1670-5176",
        buyer_addr: "성수이로 20길 16",
        buyer_postcode: "04783",
        app_scheme: "portone://",
        m_redirect_url: "https://helloworld.com/payments/result",
        notice_url: "https://helloworld.com/api/v1/payments/notice",
        confirm_url: "https://helloworld.com/api/v1/payments/confirm",
        currency: "KRW",
        digital: false,
        period: {
          from: "2022-12-01",
          to: "2023-01-01",
        },
        custom_data: { userId: 30930 },
        display: { card_quota: [0, 6] },
        bypass: {
          ksnet: {
            sndQpayType: "0",
          },
        },
      },
      function (rsp) {
        // callback 로직
        //* ...중략... *//
      },
    );
    ```

    **주요 파라미터 설명**

    **`pg`** <mark style="color:red;">**\***</mark> <mark style="color:green;">**string**</mark>

    **PG사 구분코드**

    `ksnet.{PG 상점 아이디}`

    **`pay_method`** <mark style="color:red;">**\***</mark> <mark style="color:green;">**string**</mark>

    **결제수단 구분코드**

    - card (신용카드)
    - vbank (가상계좌)
    - trans (계좌이체)
    - phone (휴대폰소액결제)
    - lpay (LPAY)
    - ssgpay (SSGPAY)
    - kakaopay (카카오페이)
    - naverpay (네이버페이)
    - payco (페이코)

    **`merchant_uid`** <mark style="color:red;">**\***</mark> <mark style="color:green;">**string**</mark>

    **고객사 채번 주문 고유번호**

    고객사에서 매번 고유하게 채번되어야 합니다.

    **`amount`** <mark style="color:purple;">**number**</mark>

    **결제금액**

    지정하지 않은 경우 0원입니다.

    **`tax_free`** <mark style="color:purple;">**number**</mark>

    **면세금액**

    지정하지 않은 경우 0원입니다.

    <Hint style="info">
      포트원을 통해 KSNET를 사용하는 경우 과세 설정이 `복합과세`이므로 면세금액을 반드시 입력해야 합니다.
    </Hint>

    **`buyer_name`** <mark style="color:red;">**\***</mark> <mark style="color:green;">**string**</mark>

    **구매자명**

    **`buyer_tel`** <mark style="color:green;">**string**</mark>

    **구매자 전화번호**

    **`currency`** <mark style="color:red;">**\***</mark> <mark style="color:green;">**string**</mark>

    **결제 통화**

    결제통화로 KSNET 카드 다이렉트의 경우 `KRW` 만 허용됩니다.

    **`digital`** <mark style="color:orange;">**boolean**</mark>

    **디지털 상품 유형 여부**

    <Hint style="info">
      해당 필드는 **휴대폰 결제**에서만 사용되며, 상점이 `디지털 상품유형`으로 설정된 경우 항상 `true`로 전달해야 합니다.
    </Hint>

    **`popup`**  <mark style="color:green;">**boolean**</mark>

    **결제창 팝업 호출 여부**

    **`display`** <mark style="color:blue;">**object**</mark>

    **결제창에 렌더링될 카드 할부 개월수 리스트 설정**

    > **`card_quota`** <mark style="color:green;">**number\[]**</mark>
    >
    > **할부 개월수 설정**
    >
    > `[0]` : 일시불
    > `[2,3,4]` : 2,3,4 개월

    **`card`** <mark style="color:blue;">**object**</mark>

    **카드 결제시 세부 설정 정보**

    > **`direct`** <mark style="color:blue;">**object**</mark>
    >
    > **카드사 다이렉트 호출시 설정 정보**
    >
    > > **`code`** <mark style="color:green;">**string**</mark>
    > >
    > > **카드사 코드**

    **`storeDetails`** <mark style="color:blue;">**object**</mark>

    **상점 세부 정보**

    > **`businessName`** <mark style="color:green;">**string**</mark>
    >
    > **상점 사업자 명**
    >
    > **`businessRegistrationNumber`** <mark style="color:green;">**string**</mark>
    >
    > **상점 사업자 번호**
    >
    > - 하이픈(-) 을 제외한, 숫자만 전달하여야합니다.

    **`bypass`** <mark style="color:blue;">**oneof object**</mark>

    **PG사 결제창 호출 시 PG사 그대로 bypass할 값들의 모음**

    > **`ksnet`** <mark style="color:green;">**string**</mark>
    >
    > **KSNET 전용 파라미터**
    >
    > > **`sndQpayType`** <mark style="color:green;">**string**</mark>
    > >
    > > **카드 결제 시 결제창에 간편 결제 수단 표시 여부**
    > >
    > > 0 : 간편결제 수단 표시하지 않음 / 1 : 간편결제 수단 표시함
    > >
    > > **`tcode`** <mark style="color:green;">**string**</mark>
    > >
    > > **통신사 구분**
    > >
    > > **`url`** <mark style="color:green;">**string**</mark>
    > >
    > > **고객사 url**
    > >
    > > - 결제를 요청하는 사이트의 url을 입력하여야 합니다.
  </Tab>

  <Tab title="비인증 결제창 요청">
    **KSNET은 결제창 기반 비인증 결제를 지원하지 않습니다.**
  </Tab>

  <Tab title="API 결제">
    ### 일회성 결제 요청하기

    REST [**API POST /subscribe/payments/onetime**](https://developers.portone.io/api/rest-v1/nonAuthPayment#post%20%2Fsubscribe%2Fpayments%2Fonetime)을 호출하여 일회성 결제를 요청합니다.
    요청 시 전달된 카드 정보는 포트원에 등록되지 않습니다.

    ```sh
    curl -H "Content-Type: application/json" \
         -X POST -d '{"merchant_uid":"order_id_8237352", "card_number":"1234-1234-1234-1234", "expiry":"2019-01", "birth":"123456", "amount":3000}' \
         https://api.iamport.kr/subscribe/payments/onetime
    ```

    ### 빌링키 발급 요청하기

    REST [**API POST /subscribe/customers/\{customer\_uid}**](https://developers.portone.io/api/rest-v1/billingkey#post%20%2Fsubscribe%2Fcustomers%2F%7Bcustomer_uid%7D)를 호출하여 빌링키 발급을 요청합니다.

    ```sh
    curl -H "Content-Type: application/json" \
         -X POST -d '{"card_number":"1234-1234-1234-1234", "expiry":"2025-12", "birth":"820213", "pwd_2digit":"00"}' \
         https://api.iamport.kr/subscribe/customers/your-customer-unique-id
    ```

    ### 빌링키로 결제 요청하기

    빌링키 발급과 최초 결제가 성공하면 빌링키는 전달된 `customer_uid` 와 1:1 매칭되어 포트원에 저장됩니다.
    보안상의 이유로 서버는 빌링키에 직접 접근할 수 없기 때문에 `customer_uid`를 이용해서
    재결제([**POST /subscribe/payments/again**](https://developers.portone.io/api/rest-v1/nonAuthPayment#post%20%2Fsubscribe%2Fpayments%2Fagain)) REST API를 다음과 같이 호출합니다.

    ```sh
    curl -H "Content-Type: application/json" \
         -X POST -d '{"customer_uid": "your-customer-unique-id", "merchant_uid": "order_id_8237352", "amount": 3000, "product_type": "digital"}' \
         https://api.iamport.kr/subscribe/payments/again
    ```
  </Tab>
</Tabs>

## 3. API 기능

### 승인 취소(환불)

결제 승인 완료 건에 대해 승인 취소(환불)를 할 수 있는 API입니다.\
REST [**API POST /payments/cancel**](https://developers.portone.io/api/rest-v1/payment#post%20%2Fpayments%2Fcancel)를
호출하여 승인 취소(환불)을 요청합니다.

### 현금영수증 등록

포트원을 통한 거래건이지만 결제창에서 현금영수증 등록을 하지 못한 경우 API를 통해 현금영수증을 등록할 수 있습니다.\
REST [**API POST /receipts/\{imp\_uid}**](https://developers.portone.io/api/rest-v1/receipt#post%20%2Freceipts%2F%7Bimp_uid%7D)를
호출하여 현금영수증을 요청합니다.

- `product_type`(디지털: `"digital"`, 실물: `"real"`), `buyer_name` 파라미터는 KSNET 필수 입력 대상입니다.

```sh
curl -H "Content-Type: application/json" \
     -X POST -d '{"identifier": "1178178260", "identifier_type": "business", "type": "company", "product_type": "digital"}' \
     https://api.iamport.kr/receipts/{imp_uid}
```

### 외부 현금영수증 등록

포트원을 통한 거래건이 아닌 현금성 거래의 경우에도 API를 통해 현금영수증을 등록할 수 있습니다.\
REST [**API POST /receipts/external/\{merchant\_uid}**](https://developers.portone.io/api/rest-v1/receipt#post%20%2Freceipts%2Fexternal%2F%7Bmerchant_uid%7D)를
호출하여 현금영수증을 요청합니다.

- `product_type`, `pg`, `buyer_name` 파라미터는 KSNET 필수 입력 대상입니다.

```sh
curl -H "Content-Type: application/json" \
     -X POST -d '{"merchant_uid": "order_id_1667643230720", "name": "나이키 와플 트레이너 2 SD", "amount": 109000, "identifier": "1178178260",  "identifier_type": "business", "type": "company", "product_type": "digital", "tax_free": "3000", "pg": "ksnet"}' \
     https://api.iamport.kr/receipts/external/{merchant_uid}
```

## 4. 부가기능

### 할부개월수 렌더링

결제창 호출 시 표시할 할부개월수를 설정할 수 있습니다.

```json
{
  //...중략
  "display": {
    "card_quota": [5,6] // 할부개월 5,6개월만 활성화
  }
}
```

**파라미터 설명**

<ParamTree>
  `display` <mark style="color:blue;">**object**</mark>

  **결제창에 렌더링될 카드 할부 개월수 리스트 설정**

  <ParamTree>
    - `card_quota` <mark style="color:green;">**number\[]**</mark>

      **할부 개월수 설정**

      `[0]` : 일시불
      `[2,3,4]` : 2,3,4 개월
  </ParamTree>
</ParamTree>

<Hint style="info">
  할부 결제는 **5만원 이상 결제 요청시**에만 이용 가능합니다. (현대카드의 경우 1만원 이상 결제 요청시 사용 가능)
</Hint>

### 카드사 다이렉트 호출

카드사 다이렉트 호출 시 결제대행사의 통합결제창을 거치지 않고, 지정한 카드사의 결제화면이 호출됩니다.

```json
{
  //...중략
  "card": {
    "direct": {
      "code": "361" // 카드사 지정
    }
  }
}
```

**파라미터 설명**

<ParamTree>
  `card` <mark style="color:blue;">**object**</mark>

  **카드 결제시 세부 설정 정보**

  <ParamTree>
    - `direct` <mark style="color:blue;">**object**</mark>

      **카드사 다이렉트 호출시 설정 정보**

      <ParamTree>
        - `code` <mark style="color:green;">**string**</mark>

          **카드사 코드**

          [카드사 코드 바로가기](https://developers.portone.io/docs/ko/tip/card-code?v=v1)
      </ParamTree>
  </ParamTree>
</ParamTree>

#### 유의사항

<Details>
  <p slot="summary"> 필수 파라미터 안내</p>

  - KSNET을 통한 카드사 다이렉트 호출 시 `buyer_name` 파라미터는 필수 입력해야 합니다.

  - 모바일 환경에서 **BC카드, 수협카드, 전북카드, 광주카드, 카카오뱅크카드** 를 다이렉트 호출하는 경우
    `buyer_tel`, `bypass.ksnet.tcode` 파라미터를 필수 입력해야 합니다.

  - **국민카드, 우리카드, 하나카드, 농협카드, 삼성카드, 현대카드, 롯데카드, 신한카드, 씨티카드** 를
    다이렉트 호출하는 경우 `storeDetails.businessName`, `storeDetails.businessRegistrationNumber` 파라미터를
    필수 입력해야 합니다.

  - **우리카드, 하나카드, 농협카드, 삼성카드, 현대카드, 롯데카드, 신한카드, 씨티카드** 를 다이렉트
    호출하는 경우 `bypass.ksnet.url` 파라미터를 필수 입력해야 합니다.
</Details>

<Details>
  <p slot="summary"> 국민카드 다이렉트 호출 시 팝업 방식으로 호출해야 합니다.</p>

  - `popup` 파라미터를 true로 지정하여 호출해야 합니다.
</Details>

<Details>
  <p slot="summary"> 일부 카드사의 경우 다이렉트 호출과 할부개월 리스트 렌더링을 함께 사용할 수 없습니다.</p>

  - 우리카드, 하나카드, 농협카드, 삼성카드, 현대카드, 롯데카드, 신한카드, 씨티카드의 경우 다이렉트 호출 시
    렌더링할 할부개월 리스트를 지정할 수 없습니다.
</Details>

## KSNET 연동 주의사항

<Details>
  <p slot="summary">계약 확인사항</p>

  **포트원을 통한 KSNET 이용 고객사의 상점아이디 과세 설정은 반드시 `복합과세`로 설정되어 있어야 합니다. 일반과세, 면세 설정은 지원하지 않습니다.**

  - 키인결제

  - 고객사 부담 무이자 할부 설정

  - 가상계좌 마감일시 지정

  - 가상계좌 환불

  - 간편결제 사용

  - 할부 사용

  - 에스크로 사용, 배송 에스크로만 지원
    - KSNET에서 일반 에스크로, 배송 에스크로 두 가지 유형의 에스크로를 제공합니다. 포트원을 통해 KSNET 에스크로를 사용하려는 경우 반드시 **배송 에스크로** 설정이 되어 있어야 합니다.

  - 휴대폰 결제 시 상품 유형 설정(실물 혹은 디지털)
</Details>

<Details>
  <p slot="summary">특정카드사 고객사 부담 무이자 할부 설정 불가</p>

  KSNET에서 고객사 부담 무이자 할부 설정에 필요한 카드 코드 정보를 일부 카드사에 대해서만 제공하고 있습니다. 카드코드가 제공되지 않는 일부 카드사의 경우 고객사 부담 무이자 할부를 설정할 수 없습니다.
</Details>

<Details>
  <p slot="summary">계좌이체 </p>

  ## 결제창에서 현금영수증 발급 시 사업자번호, 휴대폰 번호에 숫자만 입력해야합니다.

  계좌이체 결제창을 통한 현금영수증 발급 시 휴대폰번호, 사업자 번호는 **숫자만** 입력해야 합니다. 하이픈(-)을 포함한 다른 문자가 포함되는 경우 별다른 에러 표시 없이 결제는 진행되지만 현금영수증이 발급되지 않습니다.
</Details>

<Details>
  <p slot="summary">가상계좌</p>

  ## 예금주명 지정 불가

  가상계좌의 예금주명은 고객사명으로 고정되며 별도 지정이 불가합니다.

  ## 부가세, 면세 금액 설정 지원 안 함

  KSNET는 일회성 가상계좌의 경우 부가세, 면세 금액 설정을 지원하지 않습니다.

  ## 가상계좌 입금기한은 필수 입력 항목

  KSNET에서 가상계좌 입금기한은 선택 입력 항목으로 안내하고 있지만 입력하지 않을 경우 가상계좌 입금기한을 특정할 수 없고 오동작할 가능성이 있어 필수로 입력해야합니다. (포트원에서는 필수 값으로 제한하고 있습니다.)

  ## 가상계좌 입금기한은 **초 단위 UNIX TIMESTAMP 사용**

  `vbank_due` 파라미터로 전달하는 가상계좌 입금기한은 초 단위의 UNIX TIMESTAMP(통상 10자리 자연수)로 입력하여야 합니다. (`api로 가상계좌를 발급하는 경우에만 해당합니다.`)
</Details>

<Details>
  <p slot="summary">에스크로 서비스</p>

  ## 주문자 이메일 필수 입력

  구매 확인을 받기 위한 주문자 이메일을 필수로 입력하여야 합니다.

  ## 등록 소요 시간 존재

  에스크로 거래는 30분 \~ 1시간 뒤 [ksta.ksnet.co.kr](http://ksta.ksnet.co.kr/) > PG 거래내역 > 배송 에스크로 거래조회에서 확인이 가능합니다. 에스크로 정보 수정의 경우도 등록이 완료된 이후부터 가능합니다.

  ## 배송정보 발송일시는 **초 단위 UNIX TIMESTAMP 사용**

  `logis.sent_at` 파라미터로 전달하는 배송정보 발송일시는 초 단위의 UNIX TIMESTAMP(통상 10자리 자연수)로 입력하여야 합니다.
</Details>

<Details>
  <p slot="summary">키인결제</p>

  판매 상품에 대한 구분값으로 **`product_type`** 파라미터를 사용해야 결제가 가능합니다.

  고객사 부담 무이자를 원하시는 경우 PG사와의 별도의 계약 후 **`interest_free_by_merchant`** 파라미터를 사용해야 합니다.

  카드번호와 유효기간만으로 결제를 요청하는 비인증 승인 API만 연동되어 있어

  **`birth`**(생년월일 6자리 혹은 사업자 등록번호 10자리)와 **`pwd_2digit`**(비밀번호 앞 2자리)는 검증하지 않습니다.
</Details>

<Details>
  <p slot="summary">빌링키 결제</p>

  판매 상품에 대한 구분값으로 **`product_type`** 을 파라미터로 사용해야 결제가 가능합니다.

  고객사 부담 무이자를 원하시는 경우 pg 사와의 별도의 계약 후 **`interest_free_by_merchant`** 파라미터를 사용해야 합니다.
</Details>

<Details>
  <p slot="summary">빌링키 등록</p>

  `card_number`, `expiry`, `pwd_2digit`, `birth` 파라미터 입력은 필수 입니다.
</Details>

<Details>
  <p slot="summary">기타</p>

  - 휴대폰 결제는 부분취소 불가능.

  - 카드, 간편결제 외 결제의 경우 매출 전표 확인 불가능.

  - 간편결제(카카오페이, 페이코) 카드 결제의 경우 KSNET 측에서 카드정보(카드번호, bin) 정보를 제공해주지 않아 결제 정보에 카드사 정보가 제공되지 않습니다.

  - USD 결제는 순수 해외카드로만 결제 가능합니다.

  - 카카오페이 사용 시 상점정보(대표자명, 주소, 전화번호)를 필수로 입력해야합니다

  - 부분취소는 총 9회까지 가능합니다. (카드결제, 가상계좌, 계좌이체, 간편결제)

  - 취소는 결제일 기준 6개월 이내에만 가능합니다.

  - 가상계좌 환불은 23:00\~06:00 시간 외에만 가능합니다.

  - 계좌입금 거래 시 결제창에서 발급한 현금영수증은 경우 거래 취소 시 자동으로 취소 되지 않습니다.

  - 복합과세의 계좌입금 거래를 부분취소하는 경우 기존에 발급한 현금영수증을 취소하고 부분취소 금액이 반영된 금액 정보로 다시 현금영수증을 발급해야합니다.

  - 매출 전표 확인 시 자동으로 인쇄 기능이 호출됩니다. 오동작이 아닌 KSNET의 의도된 기능입니다.

  - 간편 결제 수단에서 고객사 부담 무이자 설정은 사용 불가능합니다.

  - 간편 결제 수단에서 할부 개월 수 표시 설정은 일부 간편결제사에서만 가능합니다.
    - 네이버페이, 카카오페이, LPay: 할부 개월 수 표시 설정 가능
    - Payco, SSGPay: 할부 개월 수 표시 설정 불가, 5만원 이상 시 1\~12 개월 표시 고정
</Details>

<Hint style="danger">
  특이사항

  - 카드, 간편결제를 외 결제 수단 에서는 매출전표를 제공하지 않습니다.
  - KSNET은 KRW, USD 만 지원합니다.
  - USD 결제의 경우 순수 해외 카드만 결제 가능합니다.
  - 페이코, 카카오페이의 경우 카드번호 혹은 카드bin 정보를 제공하지 않습니다.
  - 주문자 이메일(`buyer_email`)은 선택 입력 항목이지만 에스크로 결제에서 구매확인 이메일 수신을 위해 필수로 입력해야 합니다.
  - 카드, 간편결제 다이렉트 호출은 현재 지원하지 않습니다.
  - 발급사가 비씨,국민,하나,삼성,신한,현대,롯데,농협인 경우에 `고객사 무이자 할부`를 설정할 수 있습니다.
  - 결제 취소 시 부분취소는 9회까지 가능합니다. (카드결제, 가상계좌, 계좌이체)
  - 취소는 결제일 기준으로 6개월까지만 가능합니다.
  - 가상계좌 환불은 23:00\~06:00 시간 외에만 가능합니다.
  - 가상계좌 환불은 특약이 있는 고객사만 사용 가능합니다.
  - 휴대폰 결제는 부분취소를 지원하지 않습니다.
  - 계좌입금 거래 시 발급한 현금영수증은 경우 거래 취소 시 자동으로 취소 되지 않습니다. 수동으로 취소해야 합니다.
  - **포트원을 통한 KSNET 이용 고객사의 상점아이디 `복합과세` 및 `면세`만 지원합니다.**
</Hint>
