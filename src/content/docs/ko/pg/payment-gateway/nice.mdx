---
title: 나이스페이먼츠
description: 나이스페이먼츠 연동 방법을 안내합니다.
targetVersions: ["v1"]
versionVariants:
  v2: /ko/v2-payment/pg/nice-v2
---

import Figure from "~/components/Figure.astro";
import Codepen from "~/components/gitbook/Codepen.astro";
import Details from "~/components/gitbook/Details.astro";
import Hint from "~/components/Hint.astro";
import * as prose from "~/components/prose";
export const components = prose;

import Tab from "~/components/gitbook/tabs/Tab.astro";
import Tabs from "~/components/gitbook/tabs/Tabs.astro";

import screenshot2 from "./_assets/nice/caution/escrow-trans.png";
import screenshot1 from "./_assets/nice/caution/only-list-installment-on-mobile.png";
import screenshot3 from "./_assets/nice/caution/receipts-list-on-v1-console.png";

<Hint style="info">
  [(구)나이스페이먼츠 연동 가이드 바로가기](#구나이스페이먼츠-연동-가이드)
</Hint>

## 1. 나이스페이먼츠(신모듈) 채널 설정하기

[결제대행사 채널 설정하기](../../ready/readme#3-결제대행사-채널-설정하기) 페이지의 내용을 참고하여 채널 설정을 진행합니다.

아래 기능을 사용하시려면 나이스페이먼츠에 사전 신청 후 계약이 완료되어야 합니다.
그렇지 않은 상태에서 해당 기능 이용시 PG창 호출에 실패하거나, 승인에 실패하거나,
승인에 성공하더라도 의도한 바와는 다른 응답을 얻게 될 수 있으니 주의 해주시기 바랍니다.

- 모든 결제 수단(간편결제 포함)

- 면세 / 복합과세 사용

- 부가세 지정 금액 방식 사용(영세율 포함)

- 부분 취소

- 할부 사용

- 상점 부담 무이자 할부 사용

- 카드사 포인트 사용

- 에스크로 사용

- 해외 결제 사용

- 일부 bypass 파라미터
  - UserCI
  - MallUserID
  - DirectCouponYN
  - PaycoClientId, PaycoAccessToken
  - SamPayMallType

## 2. 최신 JavaScript SDK로 업데이트하기 <a href="#2." id="2." />

나이스페이먼츠(신모듈) 결제는 최신 SDK에서만 지원되는 기능입니다.

```html title="JS SDK"
<script src="https://cdn.iamport.kr/v1/iamport.js"></script>
```

<Hint style="info">
  **(신) 나이스페이먼츠를 연동하기 위해서는 위에 안내된 JS SDK를 이용하셔야 합니다**
</Hint>

<Hint style="danger">
  ## **기존에 deprecated된 콜백 응답은 모두 제거**됐습니다.

  신규 JS SDK는 기존 모듈에서 제공했던 CallBack 응답 파라미터가 대부분 삭제되었습니다.
  (특히 deprecated 로 명시된 파라미터는 모두 삭제되었습니다.)

  해당 JS SDK 사용시 Callback 으로 내려받을수 있는 데이터는 오직 아래 두가지 입니다.

  **`imp_uid`, `merchant_uid`**

  따라서 해당 SDK를 사용하실때는 `IMP.request_pay`로부터 응답된 객체(또는 쿼리 파라미터)에서
  `imp_uid`를 가지고 **아임포트 REST API(GET `/payments/imp_uid`)로 결제 상세 내역(승인 상태, 승인 결과 등등)을 조회**하여
  응답 파라미터 중 `status` 파라미터로 결제 상태를 파악하셔야 합니다.
</Hint>

[JavaScript SDK](../../sdk/javascript-sdk/readme) 문서를 통해 최신 SDK를 설치해주세요.

## 3.결제 요청하기

[JavaScript SDK](../../sdk/javascript-sdk/readme) `IMP.request_pay(param, callback)`을 호출하여
(신) 나이스페이먼츠 결제창을 호출할 수 있습니다. **결제 결과**는 PC의 경우 `IMP.request_pay(param,
callback)` 호출 후 <mark style="color:red;">**callback**</mark>으로 수신되고 모바일의 경우
<mark style="color:red;">**m\_redirect\_url**</mark> 로 리디렉션됩니다.

<Tabs>
  <Tab title="인증결제창 요청">
    ```ts title="Javascript SDK"
    IMP.request_pay(
      {
        pg: "nice_v2.{상점 ID}",
        pay_method: "card",
        merchant_uid: "orderNo0001",
        name: "주문명:결제테스트",
        amount: 1004,
        buyer_email: "test@portone.io",
        buyer_name: "구매자이름",
        buyer_tel: "010-1234-5678",
        buyer_addr: "서울특별시 강남구 삼성동",
        buyer_postcode: "123-456",
        m_redirect_url: "{모바일에서 결제 완료 후 리디렉션 될 URL}",
      },
      function (rsp) {
        // callback 로직
      },
    );
    ```

    <Details>
      <p slot="summary"><strong>주요 파라미터 설명</strong></p>

      **`pg` \***<mark style="color:green;">**string**</mark>

      **PG사 구분코드**

      `nice_v2` 로 지정하면 됩니다.

      **`pay_method`** <mark style="color:red;">**\***</mark> <mark style="color:green;">**string**</mark>

      **결제수단 구분코드**

      - card (신용카드)
      - trans (실시간 계좌이체)
      - vbank (가상계좌)
      - phone (휴대폰소액결제)
      - cultureland (컬쳐랜드)
      - naverpay\_card (네이버페이 - 카드)
      - naverpay\_point (네이버페이 - 포인트)
      - kakaopay (카카오페이)
      - payco (페이코)
      - samsungpay (삼성페이)
      - skpay (11Pay (구.SKPay))
      - ssgpay (SSGPAY)
      - ssgpay\_bank (SSGPAY 은행계좌)
      - lpay (LPAY)
      - applepay (애플페이)

      **`merchant_uid`** <mark style="color:red;">**\***</mark> <mark style="color:green;">**string**</mark>

      **주문번호**

      매번 고유하게 채번되어야 합니다.

      **`amount`** <mark style="color:red;">**\***</mark> <mark style="color:purple;">**`integer`**</mark>

      **결제금액**

      소수점 두번째 자리까지 허용합니다.

      **`buyer_tel`** <mark style="color:red;">**\***</mark> <mark style="color:green;">**string**</mark>

      **구매자 전화번호**

      **`vbank_due`** <mark style="color:red;">**\***</mark> <mark style="color:green;">**string**</mark>

      **가상계좌 입금기한 (YYYY-MM-DD)**

      (신) 나이스페이먼츠의 경우 필수 입력이며 날짜는 무조건 23:59:59로 설정 됨

      **`escrow`** <mark style="color:red;">**\***</mark> <mark style="color:green;">**boolean**</mark>

      **에스크로 결제 여부**

      **`period`** <mark style="color:red;">**\***</mark> <mark style="color:green;">**array**</mark>

      **서비스 제공 기간**

      날짜만 입력이 가능하며(시간은 무시) 시작 날짜와 종료 날짜를 모두 입력해야 합니다.

      **`from`** <mark style="color:orange;">**`: YYYYMMDD`**</mark>

      **`to`** <mark style="color:orange;">**`: YYYYMMDD`**</mark>
    </Details>

    <Details>
      <p slot="summary">
        <strong>결제 가능 결제수단</strong>
      </p>

      - card + 에스크로, 다이렉트
      - vbank + 에스크로
      - trans + 에스크로, 다이렉트(은행 지정 X)
      - phone + 다이렉트(통신사 지정 X)
      - cultureland
      - naverpay\_card
      - naverpay\_point
      - kakaopay
      - payco
      - samsungpay
      - skpay
      - ssgpay
      - ssgpay\_bank
      - lpay
      - applepay
    </Details>
  </Tab>
</Tabs>

<Details>
  <p slot="summary">
    <strong>가능한 결제 환경</strong>
  </p>

  - PC (iframe)
  - 모바일 (리디렉션)
</Details>

## (신)나이스페이먼츠 일반결제 연동 유의사항

## 결제창 호출 실패 사유 알 수 없음

상점 아이디 설정 이슈, 파라미터 설정 오류 등으로 결제창 호출이 불가능한 경우
PG사로부터 정확한 사유를 전달받지 못하기 때문에 다음과 같이
“알 수 없는 이유로 결제가 중단되었습니다. 나이스페이로 문의(1661-0808)하세요.” 에러를 리턴합니다.
이 메시지를 받으신 경우 결제창 호출 시 사용한 파라미터 전문과 함께 포트원으로 문의해 주시길 바랍니다.

## 카드 결제

|기능                                 |사용 가능 여부                                                                          |
|-------------------------------------|----------------------------------------------------------------------------------------|
|상점 부담 무이자 할부                |가능                                                                                    |
|다이렉트 호출                        |<font color="red"> **단독 사용 불가능** </font> (고정 할부 개월수가 함께 전달 되어야 함)|
|다이렉트 호출 + 고정 할부 개월수     |가능                                                                                    |
|다이렉트 호출 + 리스트 할부 개월수   |<font color="red"> **불가능** </font>                                                   |
|비 다이렉트 호출 + 고정 할부 개월수  |**PC만 가능**                                                                           |
|비 다이렉트 호출 + 리스트 할부 개월수|**PC만 가능**                                                                           |

### 토스뱅크 카드사 다이렉트 호출 미지원

나이스페이먼츠(신모듈)의 경우 토스뱅크 카드(card.direct.code = "092") 다이렉트 호출이 불가능합니다.

### 카드사 다이렉트 호출시 고정 할부 개월수 필수 입력

나이스페이먼츠(신모듈)는 **카드사 다이렉트 호출시
고정 할부 개월수를 <font color="red"> 필수 </font>로 입력**해야 합니다.
결제 금액이 할부 지원 금액 미만(일반적으로 50,000원 이상 결제 시 할부 기능을 지원하나
카드사에 따라 다를 수 있습니다.)인 경우 **할부 개월수를 0(일시불)으로 전달**해야 합니다.

<Details>
  <p slot="summary">BC 카드 다이렉트 호출 + 5개월 고정 할부</p>

  ```ts
  IMP.request_pay(
    {
      // ...중략
      pg: "nice_v2",
      pay_method: "card",
      card: {
        direct: {
          // 다이렉트 호출할 카드사 코드와 고정 할부 개월수를 모두 지정해야 함
          code: "361", // BC카드
          quota: 5, // 5개월 할부
        },
      },
    },
    // 콜백함수
  );
  ```
</Details>

<Details>
  <p slot="summary">삼성 카드 다이렉트 호출 + 일시불</p>

  ```ts
  IMP.request_pay(
    {
      // ...중략
      pg: "nice_v2",
      pay_method: "card",
      card: {
        direct: {
          // 다이렉트 호출 할 카드사 코드와 고정 할부 개월수를 모두 지정해야 함
          code: "365", // 삼성카드
          quota: 0, // 일시불
        },
      },
    },
    // 콜백함수
  );
  ```
</Details>

### 모바일 환경에서는 다이렉트 호출시에만 할부 옵션 설정 가능

나이스페이먼츠(신모듈)의 경우 일반 카드 결제 시(간편결제 제외) 할부 옵션(고정 할부 개월수)사용이 가능하나
**모바일 환경**에서는 **카드사 다이렉트 호출할 때만 할부 옵션 사용이 가능합니다.** 만약 모바일 환경에서 다이렉트 호출 코드 없이
할부 옵션을 전달하는 경우 무시됩니다.

<Details>
  <p slot="summary">모바일 환경에서 리스트 할부 개월수만 전달 → 전달한 파라미터가 무시되고 모든 할부 개월수 렌더링</p>

  ```ts
  IMP.request_pay(
    {
      // ...중략
      pg: "nice_v2",
      pay_method: "card",
      display: { card_quota: [2, 3, 4, 5, 6] }, // 2 ~ 6 개월 리스트 할부 개월수 적용 시도
    },
    // 콜백함수
  );
  ```

  <Figure src={screenshot1} />
</Details>

<Details>
  <p slot="summary">모바일 환경에서 3개월 고정 할부 개월수만 전달 → 전달한 파라미터가 무시되고 모든 할부 개월수 렌더링</p>

  ```ts
  // ...중략
  IMP.request_pay(
    {
      pg: "nice_v2",
      pay_method: "card",
      display: { card_quota: [3] }, // 3개월 고정 할부 개월수 적용 시도
    },
    // 콜백함수
  );
  ```

  <Figure src={screenshot1} />
</Details>

## 가상계좌

### 가상계좌 입금 기한(`vbank_due`) 필수 입력

나이스페이먼츠(신모듈) 가상 계좌 발급 시, 입금 기한은 필수 입력해야 하며 아래 4가지 형식만 유효합니다.
입금 기한을 입력하지 않거나, 유효하지 않은 형식을 입력할 경우 가상계좌 발급 결제창이 호출되지 않고 "결제 창 호출에 실패하였습니다.
나이스페이 V2 가상계좌 발급시 유효한 입금 기한을 필수로 입력해야 합니다." 라는 에러 메세지가 리턴되오니 유의하시기 바랍니다.

- YYYY-MM-DD HH:mm:ss
- YYYYMMDDHHmmss
- YYYY-MM-DD
- YYYYMMDD

## 계좌이체

### 계좌이체 다이렉트 호출시 은행 코드 지정 불가능

나이스페이먼츠(신모듈) 계좌이체 다이렉트 호출은 은행 코드를 지정하지 않고 바로 뱅크페이 결제창이 띄워지는 구조입니다.

### 계좌이체 다이렉트 호출시 현금영수증 정보는 필수 입력

계좌이체 거래는 계좌에서 현금성 결제로 현금영수증 발급이 가능하므로 현금영수증 정보를 필수로 입력해야 합니다.
만약 입력하지 않을 경우 나이스페이먼츠(신모듈) 계좌이체 다이렉트 호출 시 **현금영수증 발급 유형은 필수 입력**입니다.
라는 에러 메시지가 뜨면서 결제창이 호출되지 않으니 유의하시기 바랍니다.

### 계좌이체 에스크로 결제시에는 다이렉트 호출 불가능

나이스페이먼츠 정책상 계좌이체 + 에스크로 결제시에는 다이렉트 호출이 불가능합니다.
아래와 같이 계좌이체 + 에스크로 + 다이렉트 호출을 위한 파라미터를 설정할 경우
"나이스페이 V2 계좌이체 에스크로 결제시 다이렉트 호출은 불가능합니다."라는 에러 메시지가 뜨면서
결제창이 호출되지 않으니 유의하시기 바랍니다.

### 계좌이체 에스크로 결제시 결제창에 올바른 이메일을 입력해야 함

존재하지 않는 이메일을 입력할 경우 **이메일 주소 오류**라는 에러 메시지와 함께 승인에 실패합니다.
또한 실제로 존재하는 이메일 도메인이더라도 나이스페이먼츠 정책상 유효하지 않다고 취급하는
이메일 주소(예: .finance로 끝나는 이메일 주소)를 입력한 경우 승인은 정상적으로 되지만
**이후 API로 에스크로 등록시 에스크로 구매 확정 이메일이 전송되지 않습니다.**

<Details>
  <p slot="summary">자세히 보기</p>

  ```ts
  IMP.request_pay(
    {
      // ...중략
      pg: "nice_v2",
      pay_method: "trans", // 계좌이체 결제
      escrow: true, // 에스크로 결제
    },
    // 콜백함수
  );
  ```

  <Figure src={screenshot2} />
</Details>

## 휴대폰 소액결제

### 실물/컨텐츠 여부(`digital`) 필수 입력

휴대폰 소액결제시 실물/컨텐츠 여부(digital) 파라미터는 필수 입력입니다.
입력하지 않는 경우 "나이스페이 V2 휴대폰 소액결제시 상품 유형 파라미터는 필수 입력입니다." 라는
에러 메시지가 뜨면서 결제창이 호출되지 않으니 유의하시기 바랍니다.

|digital|의미  |
|-------|------|
|true   |컨텐츠|
|false  |실물  |

또한 상점 아이디 설정과 실물/컨텐츠 여부가 불일치할 경우 "CPID 설정 오류"라는 메시지가 리턴되며
결제창 호출에 실패하니 유의하시기 바랍니다.

## 상품권 결제

### 컬쳐랜드(`cultureland`)만 지원

나이스페이먼츠(신모듈)은 상품권 결제시 컬쳐랜드만 지원하며 북앤라이프, 스마트문상, 해피머니 등은 지원하지 않습니다.

### MallUserID(`bypass.nice_v2.MallUserID`)는 필수 입력

나이스페이먼츠(신모듈) 상품권 결제시 고객사 구매자 ID를 의미하는 MalluserID는 필수 입력이며, bypass 파라미터로 전달할 수 있습니다.

### 승인 완료시 나이스페이먼츠로부터 승인번호(`apply_num`)가 전달되지 않음

나이스페이먼츠(신모듈)은 상품권 결제시에는 승인 번호를 전달하지 않아 승인번호 확인이 어렵습니다.
따라서 결제 내역 조회시 승인 번호는 null로 리턴됩니다.

<Details>
  <p slot="summary">결제내역 조회 API 호출 결과</p>

  ```http
  GET /payments/{imp_uid}

  {
    // ...중략
    "status": "paid",
    "pay_method": "cultureland",
    "pg": "nice_v2",
    "apply_num": null
  }
  ```
</Details>

## 카카오페이

|기능                                 |사용 가능 여부                                                                                   |
|-------------------------------------|-------------------------------------------------------------------------------------------------|
|상점 부담 무이자 할부                |<font color="red"> **불가능** </font>                                                            |
|다이렉트 호출                        |BC, 국민, 삼성, 신한, 현대, 롯데, 씨티, NH농협 그리고 하나 카드만 가능                           |
|다이렉트 호출 + 고정 할부 개월수     |BC, 국민, 삼성, 신한, 현대, 롯데, 씨티, NH농협 그리고 하나 카드만 가능                           |
|다이렉트 호출 + 리스트 할부 개월수   |<font color="red"> **불가능** </font>                                                            |
|비 다이렉트 호출 + 고정 할부 개월수  |<font color="red"> **단독 사용 불가능** </font> (다이렉트 호출 할 카드사 코드를 함께 전달해야 함)|
|비 다이렉트 호출 + 리스트 할부 개월수|<font color="red"> **불가능** </font>                                                            |

## 네이버페이

|기능                                 |사용 가능 여부                                                                                   |
|-------------------------------------|-------------------------------------------------------------------------------------------------|
|상점 부담 무이자 할부                |<font color="red"> **불가능** </font>                                                            |
|다이렉트 호출                        |BC, 국민, 삼성, 신한, 현대, 롯데, 씨티, NH농협 그리고 하나 카드만 가능                           |
|다이렉트 호출 + 고정 할부 개월수     |BC, 국민, 삼성, 신한, 현대, 롯데, 씨티, NH농협 그리고 하나 카드만 가능                           |
|다이렉트 호출 + 리스트 할부 개월수   |가능(단, **일시불이 항상 포함** 됨)                                                              |
|비 다이렉트 호출 + 고정 할부 개월수  |<font color="red"> **단독 사용 불가능** </font> (다이렉트 호출 할 카드사 코드를 함께 전달해야 함)|
|비 다이렉트 호출 + 리스트 할부 개월수|가능(단, **일시불이 항상 포함** 됨)                                                              |

### 결제 수단 지정 시 카드 또는 포인트 지정 필요

나이스페이먼츠(신모듈)를 통한 네이버페이 결제 시 카드 또는 포인트 결제를 지정하여 호출해야합니다.
결제 수단(`pay_method`) 파라미터에 `naverpay` 입력은 불가능하며 `naverpay_card`(카드)
또는 `naverpay_point`(포인트/머니) 둘 중 하나로 입력해야 정상적으로 결제창이 호출되오니 유의하시기 바랍니다.

### 네이버페이 머니와 포인트 복합 결제시, 포인트가 먼저 사용 됨

네이버페이 포인트 결제시 네이버페이 머니, 포인트 또는 복합(머니와 포인트 함께 사용) 방식으로 결제가 가능하며,
만약 복합 방식으로 결제할 경우 포인트 금액이 먼저 차감됩니다.

### 네이버페이 포인트 결제시 현금영수증 정보 필수 입력

네이버페이 포인트 결제 시 현금영수증 발급이 가능하며 **현금영수증 정보를 필수로 입력**해야 합니다.
만약 입력하지 않을 경우 "나이스페이 V2 네이버페이 포인트 결제시 현금영수증 발급 유형은 필수 입력입니다."라는
에러 메시지가 뜨면서 결제창이 호출되지 않으니 유의하시기 바랍니다.
단, **네이버페이 머니로 결제할 경우에만 현금영수증이 발급**됩니다.
결제 금액 모두 네이버페이 포인트로 결제하는 경우에는 결제창 호출시 현금영수증 정보를 전달하더라도 발급되지 않습니다.

## 페이코

|기능                                 |사용 가능 여부                       |
|-------------------------------------|-------------------------------------|
|상점 부담 무이자 할부                |가능                                 |
|다이렉트 호출                        |가능                                 |
|다이렉트 호출 + 고정 할부 개월수     |가능                                 |
|다이렉트 호출 + 리스트 할부 개월수   |가능                                 |
|비 다이렉트 호출 + 고정 할부 개월수  |<font color="red"> **불가능** </font>|
|비 다이렉트 호출 + 리스트 할부 개월수|가능                                 |

## 삼성페이/11Pay (구.SKPay)/SSGPAY

|기능                                 |사용 가능 여부                       |
|-------------------------------------|-------------------------------------|
|상점 부담 무이자 할부                |가능                                 |
|다이렉트 호출                        |<font color="red"> **불가능** </font>|
|다이렉트 호출 + 고정 할부 개월수     |<font color="red"> **불가능** </font>|
|다이렉트 호출 + 리스트 할부 개월수   |<font color="red"> **불가능** </font>|
|비 다이렉트 호출 + 고정 할부 개월수  |<font color="red"> **불가능** </font>|
|비 다이렉트 호출 + 리스트 할부 개월수|<font color="red"> **불가능** </font>|

## 애플페이/LPAY

|기능                                 |사용 가능 여부                       |
|-------------------------------------|-------------------------------------|
|상점 부담 무이자 할부                |<font color="red"> **불가능** </font>|
|다이렉트 호출                        |<font color="red"> **불가능** </font>|
|다이렉트 호출 + 고정 할부 개월수     |<font color="red"> **불가능** </font>|
|다이렉트 호출 + 리스트 할부 개월수   |<font color="red"> **불가능** </font>|
|비 다이렉트 호출 + 고정 할부 개월수  |<font color="red"> **불가능** </font>|
|비 다이렉트 호출 + 리스트 할부 개월수|<font color="red"> **불가능** </font>|

## SSG 은행계좌 결제

### SSGPAY 은행 계좌 결제 시 주문 번호에 특수 문자를 사용 불가능

SSGPAY 정책상 은행 계좌 결제시에는 **주문 번호(`merchant_uid`)에 특수 문자가 허용되지 않습니다.**
주문 번호에 특수문자 입력 시 "나이스페이 V2 SSGPAY 은행 계좌 결제시 주문 번호에 특수문자는 허용되지 않습니다."와 같은
에러 메시지가 리턴되면서 결제창이 호출되지 않으니 참고 부탁드립니다.

### SSGPAY 은행 계좌 결제시 현금영수증 정보는 필수 입력

SSGPAY 은행 계좌 거래는 현금성 결제로 현금영수증 발급이 가능하므로 **현금영수증 정보는 필수 입력**입니다.
만약 입력하지 않을 경우 "나이스페이 V2 SSGPAY 은행 계좌 결제시 현금영수증 발급 유형은 필수 입력입니다."라는
에러 메시지가 뜨면서 결제창이 호출되지 않으니 유의하시기 바랍니다.

<Details>
  <p slot="summary">파라미터 예시</p>

  ```ts
  IMP.request_pay({
    // ...중략
    pg: "nice_v2",
    pay_method: "ssgpay_bank",
    bypass: {
      cashReceiptType: "corporate", // 현금영수증 발급 유형(corporate: 지출증빙, personal: 소득공제)
      customerIdentifier: "1178178260", // 현금영수증 발행 식별 정보(사업자 등록번호 또는 휴대폰 번호)
    },
  });
  ```
</Details>

### SSGPAY 은행 계좌 결제시 현금영수증 발급 정보를 확인할 수 없음

SSGPAY 은행 계좌 결제 시 현금영수증 발급 정보를 입력하여 정상적으로 발급되더라도
승인 완료(status: paid)시 나이스페이먼츠에서 현금영수증 발급 정보를 전달하지 않아
포트원 API로 결제/현금영수증 발급 내역 조회 또는 포트원 콘솔에서 현금영수증 내역을 확인할 수 없습니다.
단, 나이스페이먼츠 어드민에서는 확인이 가능합니다.

<Details>
  <p slot="summary">결제내역 조회 API 호출 결과</p>

  ```http
  GET /payments/{imp_uid}

  {
    // ...중략
    "pay_method": "trans",
    "emb_pg_provider": "ssgpay",
    "pg": "nice_v2",
    "status": "paid",
    "cash_receipt_issued": false // 실제로는 현금영수증이 발급됐으나 포트원에 정보가 없으므로 false로 내려감
  }
  ```
</Details>

<Details>
  <p slot="summary">현금영수증 발급 내역 조회 API 호출 결과</p>

  ```http
  GET /receipts/{imp_uid}

  {
    "code": -1,
    "message": "해당 아임포트 고유 번호({아임포트 번호})로 현금영수증을 발급 한 내역이 존재하지 않습니다.",
    "data": null
  }
  ```
</Details>

<Details>
  <p slot="summary">V1 콘솔 현금영수증 발급 내역</p>

  <Figure src={screenshot3} />
</Details>

## 현금영수증

### 현금영수증 발급 유형 지원 여부

현금영수증 발급 유형(`cashReceiptType`)이 소득 공제(`personal`)인 경우,
현금영수증 발급 유형(`customerIdentifier`)은 휴대폰 번호만 가능하며 주민등록번호 입력시 "현금영수증 식별 번호가 올바르지 않습니다."라는
에러 메시지가 리턴되며 결제창이 호출되지 않으니 유의하시기 바랍니다.

**계좌이체 다이렉트 호출, 네이버페이 포인트 결제, SSGPAY 은행 계좌 결제시 현금영수증 정보는 필수 입력**입니다.

<Details>
  <p slot="summary">파라미터 예시</p>

  ```ts
  IMP.request_pay(
    {
      // ...중략
      pg: "nice_v2",
      pay_method: "naverpay_point", // 네이버페이 포인트 결제
      bypass: {
        cashReceiptType: "personal", // 소득공제
        customerIdentifier: "01012345678", // 핸드폰 번호 입력(주민등록번호 불가능)
      },
    },
    // 콜백함수
  );
  ```
</Details>

### 가상계좌, 계좌이체 결제 시 현금영수증 파라미터 사용이 불가능한 경우

결제창을 통한 가상계좌 발급 또는 계좌이체 비 다이렉트 호출 시에는 현금영수증 정보를
파라미터로 전달할 수 없기(전달해도 결제창에 자동 입력되지 않음)때문에 구매자가 결제창에 직접 현금영수증 정보를 입력해야 합니다.

## (신)나이스페이먼츠 빌링키 발급 / API 연동 유의사항

## API 지원 기능

- 빌링키 발급
- 빌링키 결제
- 키인 결제
- 예약 결제
- 결제 취소(가상계좌 환불 포함)
- 에스크로 배송 정보 등록, 조회(수정 불가능)
- 가상계좌 발급, 회수(수정 불가능)
- 포트원 외부 결제 건 현금영수증 발급, 조회, 취소

## 빌링키 발급

(신) 나이스페이먼츠 빌링키 발급은 API 방식(`POST /subscribe/customers/{customer_uid}`)만 지원합니다.

## 비인증 결제

(신) 나이스페이먼츠는 발급 된 빌링키로 재결제(`POST /subscribe/payemnts/again`),
키인 결제(`POST /subscribe/payments/onetime`) 그리고 스케줄 결제(`POST /subscribe/payments/schedule`)를
모두 지원하며 기본 파라미터 외에 아래 3개의 파라미터를 추가로 지원합니다.

|파라미터                     |데이터 타입           |의미                                                                                               |
|-----------------------------|----------------------|---------------------------------------------------------------------------------------------------|
|vat\_amount                  |double                |총 결제 금액 중 부가세 금액. 부가세 직접 입력 방식을 위해 사용. 단, 나이스페이먼츠와 사전 협의 필요|
|intereset\_free\_by\_merchant|boolean(기본값: false)|상점 부담 무이자 할부 적용 여부. 단, 나이스페이먼츠와 사전 협의 필요                               |
|use\_card\_point             |boolean(기본값: false)|카드사 포인트 사용 여부. 단, 나이스페이먼츠와 사전 협의 필요                                       |

## 가상계좌

### 가상계좌 API 발급시 `business_registration_number` 파라미터 추가 지원

|파라미터                      |데이터 타입|의미                   |
|------------------------------|-----------|-----------------------|
|business\_registration\_number|string     |구매자 사업자 등록 번호|

(신) 나이스페이먼츠의 경우 API를 통한 가상 계좌 발급 시, 향후 해당 거래 건을 에스크로 배송 정보로 등록할 때
사용될 구매자의 사업자 번호를 `business_registration_number` 파라미터로 입력받고 있습니다.

### API로 가상계좌 채번은 가능하나 발급된 가상계좌 정보는 수정 불가능

(신) 나이스페이먼츠는 `POST /vbanks` API로 가상 계좌를 채번 할 수 있지만 `PUT /vbanks` API로
**이미 채번 된 가상계좌 정보(입금 기한, 입금 금액)를 수정할 수 없습니다.**

## 에스크로 결제

### 배송 정보 등록시 `send_email` 파라미터 추가 지원

|파라미터   |데이터 타입|의미                                                                                     |
|-----------|-----------|-----------------------------------------------------------------------------------------|
|send\_email|boolean    |에스크로 구매 확정시 결제 창에 입력했던 이메일로 해당 사실을 전송할지 여부 (기본값: true)|

(신) 나이스페이먼츠의 경우 에스크로 결제건에 대해 배송 정보 등록 API 호출 시 `send_email` 파라미터를
이용하여 구매 확정됐을 때 결제창에 입력한 이메일로 구매 확정 내용을 전송할지 여부를 제어할 수 있습니다.
기본 값은 true(구매 확정 여부 이메일 전송)이며 false로 입력 시 구매가 확정되어도 이메일로 안내되지 않습니다.

### 배송 정보 수정 불가

(신) 나이스페이먼츠는 `POST /escrow/logis/{imp_uid}` API로 에스크로 배송 정보 등록은 가능하지만
`PUT /escrow/logis/{imp_uid}` API로 **수정은 불가능**합니다.

## 현금영수증

### 결제창에서 발급 받지 못한 현금영수증은 API로 발급 불가능

(신) 나이스페이먼츠의 경우 현금성 결제(가상계좌, 계좌이체, 네이버페이 포인트 결제 등)시 승인 단계에서
현금영수증을 발급 요청할 수 있습니다. 이때 결제 승인 단계에서 현금영수증을 발급 요청하지 못한 경우,
현금영수증 발급 API(`POST /receipts/{imp_uid}`)를 사용한다고 하더라도 발급이 되지 않으니 참고 부탁드립니다.

### API로 현금영수증 발급 시, 현금영수증 카드 사용 불가능

API로 현금영수증 발급(`POST /receipts/{imp_uid}`)시 발급 받을 현금영수증 정보(현금영수증 발급 유형,
현금영수증 발행 식별 정보, 현금영수증 발행 식별 정보 유형)를 전달해야 합니다.
단, (신) 나이스페이먼츠의 경우 **현금영수증 카드 번호로 현금영수증 발급이 불가능**하오니 참고 부탁드립니다.

<Details>
  <p slot="summary">\[가능] 사업자 등록번호로 지출증빙용 현금영수증 발급</p>

  ```http
  POST /receipts/{imp_uid}

  {
    // ...중략
    "type": "company", // 현금영수증 발급 유형: 지출증빙
    "identifier": "1178178260", // 현금영수증 발행 식별 정보: 사업자 등록번호
    "identifier_type": "business" // 현금영수증 발행 식별 정보 유형: 사업자 등록번호
  }
  ```
</Details>

<Details>
  <p slot="summary">\[가능] 휴대폰 번호로 소득공제용 현금영수증 발급</p>

  ```http
  POST /receipts/{imp_uid}

  {
    // ...중략
    "type": "personal", // 현금영수증 발급 유형: 소득공제
    "identifier": "01012345678", // 현금영수증 발행 식별 정보: 휴대폰 번호
    "wdentifier_type": "phone" // 현금영수증 발행 식별 정보 유형: 휴대폰 번호
  }
  ```
</Details>

<Details>
  <p slot="summary">\[가능] 주민등록번호로 소득공제용 현금영수증 발급</p>

  ```http
  POST /receipts/{imp_uid}

  {
    // ...중략
    "type": "personal", // 현금영수증 발급 유형: 소득공제
    "identifier": "9010102012345", // 현금영수증 발행 식별 정보: 주민등록번호
    "identifier_type": "person" // 현금영수증 발행 식별 정보 유형: 주민등록번호
  }
  ```
</Details>

<Details>
  <p slot="summary">\[불가능] 현금영수증 카드번호로 소득공제용 현금영수증 발급</p>

  ```http
  POST /receipts/{imp_uid}

  {
    // ...중략
    "type": "personal", // 현금영수증 발급 유형: 소득공제
    "identifier": "123456789012", // 현금영수증 발행 식별 정보: 현금영수증 카드번호
    "identifier_type": "taxcard" // 현금영수증 발행 식별 정보 유형: 현금영수증 카드번호
  }
  ```
</Details>

## (구)나이스페이먼츠 연동 가이드

<Hint style="warning">
  **나이스페이먼츠(구모듈) 연동 방법에 관한 매뉴얼**입니다.

  신규 연동 고객사이시거나 나이스페이먼츠 신모듈로 업그레이드를 원하신다면 [나이스페이먼츠(신모듈) 연동 가이드](#1-나이스페이먼츠신모듈-채널-설정하기)를 참고하여 진행해주세요.
  구모듈에 비해 신모듈에서 다양한 기능 및 결제수단을 지원하고 있습니다. 신규 고객사의 경우 가급적 신모듈로 연동하는 것을 권장드립니다.
</Hint>

## 1. (구)나이스페이먼츠 채널 설정하기

[결제대행사 채널 설정하기](../../ready/readme#3-결제대행사-채널-설정하기) 페이지의 내용을 참고하여 채널 설정을 진행합니다.

<Figure src="/gitbook-assets/ko/screenshot 2022-05-29 7.44.33.png" />

## 2. 결제 요청하기

[JavaScript SDK](../../sdk/javascript-sdk-old/readme) `IMP.request_pay(param, callback)`을 호출하여
NICE페이먼츠 결제창을 호출할 수 있습니다.
**결제결과**는 PC의 경우 `IMP.request_pay(param, callback)` 호출 후
<mark style="color:red;">**callback**</mark> 으로 수신되고
모바일의 경우 <mark style="color:red;">**m\_redirect\_url**</mark> 로 리디렉션됩니다.

<Tabs>
  <Tab title="인증결제창 요청">
    ```ts title="Javascript SDK"
    IMP.request_pay(
      {
        pg: "nice.{상점 ID}",
        pay_method: "card",
        merchant_uid: "order_no_0001", // 상점에서 생성한 고유 주문번호
        name: "주문명:결제테스트",
        amount: 1004,
        buyer_email: "test@portone.io",
        buyer_name: "구매자이름",
        buyer_tel: "010-1234-5678",
        buyer_addr: "서울특별시 강남구 삼성동",
        buyer_postcode: "123-456",
        language: "en", // 결제창 언어 선택 파라미터  ko: 한국어, en: 영문
        m_redirect_url: "{모바일에서 결제 완료 후 리디렉션 될 URL}",
        niceMobileV2: true, // 신규 모바일 버전 적용 시 설정
      },
      function (rsp) {
        // callback 로직
        //* ...중략... *//
      },
    );
    ```

    ### **주요 파라미터 설명**

    ---

    **`pg` \***<mark style="color:green;">**string**</mark>

    **PG사 구분코드**

    **`nice`** 로 지정하면 됩니다.

    **`pay_method`** <mark style="color:red;">**\***</mark> <mark style="color:green;">**string**</mark>

    **결제수단 구분코드**

    - card(신용카드)
    - trans(실시간 계좌이체)
    - vbank(가상계좌)
    - phone(휴대폰소액결제)
    - kakaopay(카카오페이)

    **`merchant_uid`** <mark style="color:red;">**\***</mark> <mark style="color:green;">**string**</mark>

    **주문번호**

    매번 고유하게 채번되어야 합니다.

    **`amount` \***<mark style="color:purple;">**number**</mark>

    **결제금액**

    **string** 이 아닌점에 유의하세요

    **`niceMobileV2`** <mark style="color:orange;">**`boolean`**</mark>

    나이스 모바일 신규버전 적용 여부(기본 값: `false`)

    **`escrow`** <mark style="color:orange;">**`boolean`**</mark>

    **에스크로 설정여부**

    **`currency`** <mark style="color:green;">**string**</mark>

    **결제 통화(기본 값: KRW)**

    - KRW(한국 원)
    - USD(미국 달러)(모바일의 경우 `niceMobileV2` 파라미터가 `true`일 경우에만 사용 가능)

    <Codepen user="chaiport" slug="qBxbGXy" caption="나이스페이먼츠 결제창 예제" />
  </Tab>

  <Tab title="비인증 API 요청">
    **API 방식으로 빌링키 발급,결제요청,예약결제를 구현할수 있습니다.**

    ---

    **일회성 결제 요청하기**

    REST [**API POST /subscribe/payments/onetime**](../../api/api-4/api-1)을 호출하여 일회성 결제를 요청합니다. 요청 시 전달된 카드는 포트원에 등록되지 않습니다.

    ```sh
    curl -H "Content-Type: application/json" \
         -X POST -d '{"merchant_uid":"order_id_8237352", "card_number":"1234-1234-1234-1234", "expiry":"2019-01", "birth":"123456", "amount":3000}' \
         https://api.iamport.kr/subscribe/payments/onetime
    ```

    ---

    **빌링키 발급 요청하기**

    REST [**API POST /subscribe/customers/\{customer\_uid}**](../../api/api-2/api-1)를 호출하여 빌링키 발급을 요청합니다.

    ```sh
    curl -H "Content-Type: application/json" \
         -X POST -d '{"card_number":"1234-1234-1234-1234", "expiry":"2025-12", "birth":"820213", "pwd_2digit":"00"}' \
         https://api.iamport.kr/subscribe/customers/your-customer-unique-id
    ```

    ---

    **빌링키 발급 및 최초 결제 요청하기**

    REST [**API POST /subscribe/payments/onetime**](../../api/api-4/api-1)을 호출하여 빌링키 발급과 최초 결제를 요청합니다.

    - **`customer_uid`** : 빌링키 등록을 위해서 지정해야 합니다.

    ```sh
    curl -H "Content-Type: application/json" \
         -X POST -d '{"customer_uid":"your-customer-unique-id", "merchant_uid":"order_id_8237352", "card_number":"1234-1234-1234-1234", "expiry":"2019-01", "birth":"123456", "amount":3000}' \
         https://api.iamport.kr/subscribe/payments/onetime
    ```

    ---

    **빌링키로 결제 요청하기**

    빌링키 발급과 최초 결제가 성공하면 빌링키는 전달된 `customer_uid` 와 1:1 매칭되어 포트원에 저장됩니다.
    보안상의 이유로 서버는 빌링키에 직접 접근할 수 없기 때문에 `customer_uid`를 이용해서
    재결제([**POST /subscribe/payments/again**](../../api/api-4/api)) REST API를 다음과 같이 호출합니다.

    ```sh
    curl -H "Content-Type: application/json" \
         -X POST -d '{"customer_uid":"your-customer-unique-id", "merchant_uid":"order_id_8237352", "amount":3000}' \
         https://api.iamport.kr/subscribe/payments/again
    ```

    <Hint style="info">
      **나이스페이먼츠는 비인증 결제는 API 방식으로만 지원됩니다.**

      비인증 결제를 연동하기 위해서는 카드정보를 획득할수 있는 UI를 구성해 주셔야 하며
      해당 가이드는 [**링크**](../../auth/guide-1/readme)에서 확인해주시면 됩니다.
    </Hint>
  </Tab>
</Tabs>

## 3. 부가기능

<Tabs>
  <Tab title="할부개월수 설정">
    ```json
    {
      "display": {
        "card_quota": [6] // 할부개월 6개월까지만 활성화
      }
    }
    ```

    **파라미터 설명**

    - **`card_quota`:**
      - `[]`: 일시불만 결제 가능
      - `2,3,4,5,6`: 일시불을 포함한 2, 3, 4, 5, 6개월까지 할부개월 선택 가능\\

    <Hint style="info">
      할부결제는 **5만원 이상 결제 요청 시**에만 이용 가능합니다.
    </Hint>

    <Codepen user="chaiport" slug="poagmae" caption="할부개월수 3개월까지 활성화 예제**" />
  </Tab>

  <Tab title="카드사 모듈 바로 호출">
    ```json
    {
      "card": {
        "direct": {
          "code": "367",
          "quota": 3
        }
      }
    }
    ```

    **파라미터 설명**

    - **`code`** : 카드사 금융결제원 표준 코드. [<mark style="color:red;">**링크**</mark>](https://faq.portone.io/6503bcb4-4a61-4cf3-afd8-5d913b1385a6) 참조 (**string**)
    - **`quota`** : 할부 개월 수. 일시불일 시 0으로 지정. (**number**)

    <Hint style="danger">
      **주의사항**

      - 일부 PG사의 경우, 모든 상점아이디에 대하여 카드사 결제창 direct 노출 기능을 지원하지 않습니다. 반드시 포트원을 통해 현재 사용중인 상점아이디가 카드사 결제창 direct 호출이 가능하도록 설정이 되어있는지 PG사에 확인이 필요합니다.
    </Hint>

    <Codepen user="chaiport" slug="Yzewbeg" caption="현대카드 결제모듈 바로 호출 예제" />
  </Tab>

  <Tab title="특정 카드사 노출">
    ```json
    {
      "card": {
        "detail": [
          { "card_code": "*", "enabled": false }, //모든 카드사 비활성화
          { "card_code": "366", "enabled": true } //특정 카드만 활성화
        ]
      }
    }
    ```

    **파라미터 설명**

    - **`card_code` :** 금융결제원 카드사 코드. [<mark style="color:red;">**링크**</mark>](https://faq.portone.io/6503bcb4-4a61-4cf3-afd8-5d913b1385a6) 참조 (<mark style="color:green;">**string)**</mark>
    - **`enabled` :** 해당 카드 활성화 여부 (<mark style="color:orange;">**boolean)**</mark>

    <Codepen user="chaiport" slug="MWQKdVo" caption="신한카드만 결제창 노출 처리 예제" />
  </Tab>

  <Tab title="부가세 지정">
    ```json
    // 영세율 결제 경우
    {
      "amount": 1000,
      "tax_free": 0,
      "vat_amount": 0 // 부가세 지정
    }
    ```

    **파라미터 설명**

    - **`vat_amount`**: 상점 아이디 설정이 지정금액 방식인 경우 부가세 지정 가능 (number)

    <Hint style="danger">
      주의사항

      - 상점 아이디 설정이 지정금액 방식인 경우에는 취소 시에 공급가액, 부가세, 봉사료, 면세금액 등을 설정하도록 하고 있습니다.([링크](https://developers.nicepay.co.kr/tip.php)의 1617 코드 참조). 취소 시 취소할 금액, 부가세, 면세금액을 정확하게 전달해 주셔야 공급가액, 부가세, 면세금액, 봉사료(0원)가 설정되어 정상적으로 취소가 된다는 점 주의해주시기 바랍니다.
    </Hint>
  </Tab>
</Tabs>
